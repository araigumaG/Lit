# phttpdの使い方

phttpdディレクトリ上で、以下のコマンドを実行するだけです。

```
$ ./start_phttpd 8080
```

この場合8080番ポートでwebサーバーが起動します。引数なしの場合は1234番ポートです。なお初回はphttpd.confを吐き出して終了します。必要に応じて、confファイルを書き直し再実行してください。phttpdの特徴を列挙しておきます。

- 静的ページのWebサーバー 
- 動的ディレクトツリーメニューの生成
- 必要に応じてアクセスログとエラーログの収集
- POSIX準拠 
- 設定ファイルにより接続と動作の設定が可能
- サイズが小さい 
- 英名ファイルディレクトリのみ
- 隠されたディレクトリ/ファイルは不許可
- DOCROOTの親ディレクトリ参照も不許可
- HTTPエラー応答
    - 404お探しのページが見つかりませんでした
    - 403許可されていない
    - 400不正な要求
    - 500内部エラー

など、phttpdでは上記のような基本的なことが実行可能です。いまだにできないことやよくわかっていない点は以下のようになっていて、近いうちにPOSIX原理主義聖典をみながら実装予定

1. 非特権ユーザーとして80番で実行する
2. URLデコード（％XX）
3. loggerによるログ出力
4. caseによるREQUESTとRESPONSE処理の改良
5. content-lenghtの改良
6. cookie操作

まだ他にもいろいろとダメなところやセキュリティ的にまずいところもありそうですが、ひとまずは一回目の早めの試作です。「ソフトウェアに完全なものはありません。リリースがあるのみ」とUNIX哲学にも書かれています。シェルスクリプトでちょっと頑張れば、動的コンテンツのお届けもできると思います

# 設定ファイルの書き方
ここでは設定ファイルを見ていきます。以下のいずれかの書き方が基本となります。

```
on_uri_match BRE command [args]
　　　　　（or）
without_condition command [args]
```

どちらも名詞と動詞を持つ完全な文として記述可能です。argsの部分に供給したいファイルやディレクトリを指定してください。

```
on_uri_match BRE command [args]
―――BRE正規表現で書かれたURIにマッチした場合に直後のコマンドを実行します。
```
```
without_condition command [args]
―――無条件で直後のコマンドを実行します。
```

使用できるコマンド群は以下のようになっていますが、必要に応じてコマンドを自作していただければ、もっと柔軟にいろいろなニーズに対応できることと思います。

```
serve_static_string STRING
     #Content-Type text / plainで指定された静的文字列を提供します
serve_file FILE
     #1つのファイルを静的に提供します。
serve_dir_with_tree DIRECTORY
     #POSIX原理主義かつシェル芸的な'tree'コマンドを使用して、
     #指定されたディレクトリをリンクまで含めて静的に提供します。
serve_dir_with_tree_txt DIRECTORY
     #シェル芸'tree'コマンドを使用して、
     #指定されたディレクトリをテキスト形式で静的に提供します。
serve_dir_with_ls DIRECTORY
     #'ls -al'を使用して、指定されたディレクトリを静的に提供します
serve_dir DIRECTORY
     #1つのディレクトリのリストを提供します。
     #通常HTML版'tree'コマンドを使用します
     #お好みに応じて、 テキスト版'tree'または'ls -al'を使えます。
serve_dir_or_file_from DIRECTORY
     #クライアント要求のURIで部分指定されたものに、
     #ルートディレクトリのパスを追加してローカルパスを構築します。
     #ディレクトリ一覧（serve_dirを使用）
     #またはファイル（serve_fileを使用）を提供します。
     #要求ディレクトリ内にindex.htmlがあればそれを表示します。
```

上記コマンドを使って、設定ファイルphttpd.confを書き直してください。おススメの設定は例えば、以下のようなものです。

# Recommended Example:

```
DOCROOT='/mnt/c/Users/username/OneDrive/Documents'
on_uri_match '/.*' serve_dir_or_file_from "$DOCROOT"
```

上記の例では、ユーザーがリクエストした文字列が/を含む任意の文字列の場合にマッチし、それに該当するファイルまたはディレクトリがあれば、それを提供します。ディレクトリリストはHTMLによる相対パスリンク付きで表示されるので、ユーザーは好きなディレクトリ、ファイルに簡単にアクセスできます。