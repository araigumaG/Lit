# Lit - 怪人メイド女（Webサーバーの姿をした怪人）
これはPOSIX shに準拠したシンプルで小さいWebサーバー怪人です。
きっと、よく仕えて、あなたの望むファイルやディレクトリのリストを、
あなたの望む時に供給してくれるに違いありません。netcatとsocatで動作します。

なお、この怪人メイド女は不完全なサイボーグなので若干の欠陥を持っています。
扱いには注意してください。そして改造手術を施し、怪人をさらに進化させてくれる
ご主人さまをお待ちしております。

POSIX原理主義はちょー楽しいので、その楽しさをわかってもらうために、
怪人メイド女にはlitと名付けました。Git「間抜け」の命名例よりパクりました。
Lit「ちょー楽しい」という意味です。なお、サーバーの表記が怪人メイド女となっています。

## 特徴
怪人メイド女-Litの基本的な機能は以下のようになっています。

- 静的ページのwebサーバーです。 
- POSIX原理主義
    - コピーしてくるだけで、いつでも、どこでも、すぐにお仕えできます。
    - 途中で壊れない、きっとあなたの完璧なメイドになりえます。
    - 'write onece, run anywhere, run for good'
- 拡張子が.shのシェルスクリプトを実行できます。動的にページを生成可能なポテンシャル
- ディレクトリの場合にはディレクトリツリーを生成します。
    - directory.shを改変すれば好きな形にできます。
    - 改造すれば、リダイレクトも簡単なはずです（近日改造予定）。
- ログの収集も場合によっては可能ですが、改良の余地ありです。
- 設定ファイルはありません。
- 接続と動作の設定はオプションで行います
- 軽量なシングルファイルです。
- 写像的プログラミング（好みによります。個性の強い怪人です）
- 英語しか理解のできない、言語能力に難のある怪人です。他の言語も学習中です。
- 隠しファイルは表示しません
- 親ディレクトリの参照はできません
- HTTP Error responses
    - 405 Method Not Allowed
    - 404 Not Found
    - 403 Forbidden
    - 400 Bad Request
    - 500 Internal Error

## 使い方

怪人メイド女の扱いは簡単です。ディレクトリで以下のコマンドを実行するだけです。

```
$ ./lit -r 'REGEX' -p PORT_NUMBER -d ROOT_DIRECTORY
```
-pオプションで、指定したポート番号"PORT_NUMBER"で接続を待ち受けます。
ルートディレクトリは-dオプションで指定したディレクトリです。

なお、-rオプションで指定された正規表現とリクエストURIがマッチした場合に限り、
ルートディレクトリ内より対象のファイルまたはディレクトリを供給することができます。

なお、これらのオプションを指定しなかった場合ですが、デフォルトルートディレクトリは、
ユーザーディレクトリとなります。デフォルトのポートは１２３４番ポートで、
マッチ可能なデフォルトURIは`/`から始まる任意のパスです。


## オススメの例と動作機構
ここではオススメの使い方と、具体的な動作について説明します。
```
$ ./lit -r '/.*' -d . -p 8080
```
この例では、怪人メイド女-Litは8080番ポートで動作します。ルートディレクトリは、
コマンドを実行したカレントディレクトリです。URIはBRE正規表現である'/.*'にマッチします。

この例では、8080番ポートで以下のように動作します。

1. クライアント要求の’/から始まる任意のURI’で部分指定されたものに、
ルートディレクトリのパスを追加して、カレントディレクトリ内のローカルパスを構築します。
2. 構築されたローカルパスのディレクトリまたはファイルが存在するか、lsで問い合わせます
3. 要求がディレクトリであれば、中身をツリーでリスト表示（注1）し、
ファイルであればファイルを提供します。（なお、要求ディレクトリ内にindex.htmlがあればそれを表示します）

（注１）ディレクトリのリストは相対パスリンクつきで表示されますので、
任意のファイルまたはフォルダに簡単に移動できます。

## debug
ちなみに、-fオプションでlitはフィルタとして振舞います。擬似リクエストを送れば、
それに対するレスポンスを返してくれます。改造が捗ると思います。

以下のような形です。リクエスト先のhoge.shの中身は
```
#!/bin/sh

echo hello
```
です。標準出力に以下のように出力されます。
```
$./lit -f
GET /hoge.sh teketo

HTTP/1.1 200 OK
Date: ****
Expires: ****
Server: 怪人メイド女
Content-Type: text/html; charset+"UTF-8"

hello
```
## 対応予定の機能と問題点

怪人メイド女は、サイボーグなので改良していく予定です。対応予定の機能は以下の通りです。

1. 非特権ユーザーでのポート８０番での実行
2. URLデコード
3. loggerによるログ出力
4. 他のMETHOD(PUT, POST, DELETE, ...)への対応
6. cookie

なお、netcatはBSD版のnetcatを想定しています。ですがこれがなかなかうまく動作してくれません。
改良案を募集中でございます。おすすめはsocatの使用で、socatが存在すれば、socatで動作します。
しかも、この場合は特に問題もなくマルチスレッドで動作してくれます。

## Requisites

* cat
* date
* file
* sed
* awk
* netcat
* socat
* mime-make(@shellschoccarjpn)

## LICENSE
This software is released under the MIT License, see LICENSE
